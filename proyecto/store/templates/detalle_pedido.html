{% extends "base.html" %}
{% load static %}
{% load matematicas %}
{% block content %}
<div class="container mt-4 mb-5">

    <a href="/misPedidos" class="btn btn-secondary mb-3">← Volver a mis pedidos</a>

    <h2 class="mb-4">Detalle del Pedido Nº {{ pedido.numero_pedido }}</h2>

    <div class="card p-4 shadow-sm">

        <!-- Estado -->
        <div class="d-flex justify-content-between mb-3">
            <h4 class="m-0">Estado:</h4>
            <span class="badge 
                {% if pedido.estado == 'Pendiente' %} bg-warning 
                {% elif pedido.estado == 'Procesando' %} bg-primary 
                {% elif pedido.estado == 'Enviado' %} bg-info 
                {% elif pedido.estado == 'Entregado' %} bg-success 
                {% elif pedido.estado == 'Cancelado' %} bg-danger 
                {% endif %}
                p-2 fs-6">{{ pedido.estado }}
            </span>
        </div>

        <hr>

        <!-- Datos del pedido -->
        <h5 class="mt-3">Información del pedido</h5>
        <p><strong>Fecha:</strong> {{ pedido.fecha_creacion|date:"d/m/Y H:i" }}</p>
        <p><strong>Método de pago:</strong> {{ pedido.metodo_pago }}</p>
        <p><strong>Dirección de envío:</strong> {{ pedido.direccion_envio }}</p>
        {% if pedido.telefono %}
            <p><strong>Teléfono:</strong> {{ pedido.telefono }}</p>
        {% endif %}

        <hr>

<h5 class="mt-4 mb-3">Productos del pedido</h5>

<div class="list-group">

    {% for item in pedido.items.all %}
    <div class="list-group-item d-flex justify-content-between align-items-center">

        <div class="d-flex align-items-center">
            {% if item.producto.imagen %}
                <img src="{{ item.producto.imagen.url }}" 
                     alt="{{ item.producto.nombre }}"
                     style="width:60px; height:60px; object-fit:cover; border-radius:8px;"
                     class="me-3">
            {% endif %}

            <div>
                <strong>{{ item.producto.nombre }}</strong><br>
                <small>Precio unitario: {{ item.precio_unitario }} €</small><br>
                <small>Cantidad: {{ item.cantidad }}</small>
            </div>
        </div>

        <div class="text-end">
            <strong>{{ item.precio_unitario|floatformat:2 }} × {{ item.cantidad }}</strong>
            <div class="fw-bold fs-5">{{ item.precio_unitario|mul:item.cantidad }} €</div>
        </div>

    </div>
    {% empty %}
        <p>No hay productos asociados a este pedido.</p>
    {% endfor %}

    </div>
    <hr>


        <!-- Totales -->
        <h5 class="mt-3">Resumen del pago</h5>
        <p><strong>Subtotal:</strong> {{ pedido.subtotal }} €</p>
        <p><strong>Impuestos:</strong> {{ pedido.impuestos }} €</p>
        <p><strong>Coste de entrega:</strong> {{ pedido.coste_entrega }} €</p>
        {% if pedido.descuento > 0 %}
            <p class="text-success"><strong>Descuento:</strong> -{{ pedido.descuento }} €</p>
        {% endif %}
        <h4 class="mt-3"><strong>Total:</strong> {{ pedido.total }} €</h4>
    </div>

</div>
{% endblock %}
